# Memory

## 概述

保存 AI 助手产生的各种信息，提供记忆存储、搜索和闪回功能。

## 核心功能

### 1. 被动记忆

被 Hub 刷出注意域的内容，Memory 会被动记忆。

### 2. 提取记忆

- **被动/闪回**：从当前注意域中联想记忆中可能相关的内容
- **主动**：根据线索在记忆中查询和扩展

## 记忆图

### 设计动机

我希望 AI 具有联想能力，也就是"闪回"功能。人在思考或受到外界刺激时会闪回一些记忆——回想起一些事，但有时只是模糊的、碎片的，并非完整记忆。但如果主动回忆，往往能从这些模糊碎片不断扩展、补充，逐渐拼凑成完整记忆。

### 实现思路

我想模拟这个过程，因此将记忆构建成图：

- 图的每个节点是足够碎片化、细小的记忆点
- 记忆点之间通过边连接
- 边具有属性表示关系
- 与事件一样，记忆点也有大小限制，过大的内容应拆分成多个记忆点

## 结构化存储

### 设计理念

记忆模块不必完全模仿人类，计算机可以在某些方面做得更好！例如，记忆结构化数据时，可以又快又好。

### 混合存储方案

记忆模块应同时具备：
- **图存储**：碎片化但易于"联想"
- **结构化存储**：对结构化数据更方便，虽然缺少关联

### 存储决策机制

- 存储决策完全由 Memory 模块负责，外部模块无需关心存储方式
- 根据记忆内容的特性自动选择最佳存储方式（结构化数据适合结构化存储，自然语言适合图存储）
- 一份记忆只存一份，避免数据一致性问题
- **待调研**：需要调研记忆图谱技术和现有 MCP 实现，以制定具体的存储决策算法

这两者不应孤立，而应相互结合，使记忆模块可以通过"联想"提取某些结构化记忆。

## 优先顺序与热度统计

记忆具有多重优先顺序：
- **时间**：最近 vs 久远
- **重要性**：记忆强度（由分析 LLM 评估）
- **热度**：访问次数统计

### 闪回触发机制

- 基于注意域新增内容的大小阈值（提供默认值，可调整）
- 基于时间间隔
- 记忆模块设置冷却 CD 时间，避免过度闪回
- 闪回内容优先级低于 Mind 主动请求的记忆提取

可以自由控制搜索时间：
- 优先搜索最近、最强、最热的记忆
- 随着时间增加，也能回忆起更早、更弱、较冷的记忆

## 独立管理与重要性评估

记忆是独立模块，Mind 无法指示：
- 应该如何记忆
- 记忆什么内容
- 记忆点的关联方式

### 重要性评估机制

- **持久化重要性**：由分析 LLM 根据语义判断哪些信息应该被持久化
- **访问重要性**：记录访问次数作为记忆内容的重要性指标

Mind 能做的，就是多想。

记忆模块能够：
- 从自然语言中发现关键字
- 将提取出的记忆总结成自然语言
- 主动触发闪回提供线索，供 Mind 把握并深度回忆

这实现了与 Mind 的解耦，使得 Mind 不需要关心记忆的细节和实现。