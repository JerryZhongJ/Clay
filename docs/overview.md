# 项目概览

## 核心理念

本项目致力于构建一个具有自主性和持续存在感的 AI 助手。

当前基于 LLM 的对话交互方式使 AI 过于被动:用户激活 LLM,LLM 活跃一段时间后又归于沉寂。即便是具备规划能力、能够制定任务列表的各类 Agent,也只是延长了活跃时间而已。这带来两个核心问题:一方面,LLM 无法即时响应,除非接收到新的 prompt 或被打断;另一方面,它的长期记忆能力依然薄弱。

市面上已有不少基于 LLM 的实时对话模型和 AI VTuber(如 Neuro)。实际上,Neuro 代表了我心目中的理想形态。尽管如此,我仍然启动这个项目,因为我想验证自己的一些独特想法。

### 核心想法

本项目有两个核心设计理念:

#### 1. 事件流式组织

以事件流的形式组织 prompt 和输出,这是项目的主要创新点。所有活动都用事件表达,所有文本也以事件流的形式呈现。

LLM 的 context 被视为**注意域**(Attention Field,与 Transformer 的 attention 机制不同)。外部输入转化为一个个事件填入注意域,LLM 的思考和反应同样也是事件。每个事件应该足够小——不能是长篇大论,不应占据过多注意空间,而应让各类事件能够及时进入注意中。

**细碎性和灵活性**是事件流的设计目的。事件流能让各种输入及时反映给 LLM,也能让 LLM 做出即时反应。更重要的是,它为下一个核心想法奠定了基础。

#### 2. 记忆闪回

让记忆模块根据当前注意力持续选择相关记忆,并将其植入当前注意中。

*注:当前的 AI VTuber 可能已经实现了类似功能,但具体实现方式尚不明确,需要进一步调研。*

为实现这一点,记忆需要以非常灵活的方式组织。这种灵活性体现在**时间维度**上:

- 用较少时间可以提取较少的信息,可能是模糊且不完整的
- 用更多时间可以提取更多信息,逐渐丰富和清晰
- 可以决定哪些信息一带而过,哪些信息深入挖掘

### 设计动机

这个想法源于 Claude Code 未能展现我期望的长期注意力——每次 `/clear` 后如同换了一个人。

问题有两方面:

1. **被动记忆检索**:提取记忆需要 Agent 主动搜索各种文档。如果 Agent 忘记搜索,记忆就白白浪费了。这很可能发生——它如何知道某个概念之前出现过,值得去搜索呢?通常只能在任务开始时做一次记忆搜索,之后就不再触碰。

2. **记忆组织形式受限**:Memory 以 Markdown 组织,各种信息被强行排列成顺序结构,缺乏灵活性,限制了"联想"能力。AI 只能艰难地从"失忆"前的日记中搜索相关文件(我让它写入 Serena 的 memory,Claude 本身的 memory 无法完成此事),全部读入后再挑出相关部分。

## 总体架构

AI 助手由多个 Faculty 组成,它们以异步方式交互:

### Faculty 概览

- **Hub 协调器** - 系统核心协调者，负责 Faculty 管理和活动路由
- **AttentionField** - 管理注意域，产生活动
- **Conscious** - AI 助手的意识与灵魂，负责产生想法和意图
- **Memory** - 保存和提取记忆，提供闪回功能
- **Terminal** - AI 助手与用户的异步交互界面
- **Clock** - 时间工具，提供报时、倒计时、闹钟功能
- **Internet** - 网络访问工具，让 AI 助手获取网络信息

*详细 Faculty 说明请参考 [modules/](./modules/) 目录下的各 Faculty 文档*

## 事件/活动

**术语说明**: 本文档使用"活动"(Activity)替代"事件"(Event),以强调模块间交流的本质。

### 活动结构

一个活动应包含:
- **主体**(Subject)
- **动作**(Verb)
- **唯一ID**:便于日志追踪
- **优先级**(Priority): 0-9范围，9最高，默认5

**活动构建器**:
- 使用Builder模式创建活动
- 验证优先级范围(0-9)和大小限制
- 验证失败返回undefined
- 提供常量：PRIORITY_LOWEST, PRIORITY_HIGHEST, PRIORITY_DEFAULT(5)

### 活动分类

活动类型使用TypeScript Interface实现，作为标记接口：

- **UnderConscious**:"潜意识"活动,不出现在注意域中,但会出现在活动流中
- **WakeUp**:当系统沉睡时,此类活动会将系统唤醒

具体的活动类型可以实现多个接口。更多活动类型可以在开发过程中逐步添加。

**重要**:活动不是日志。活动是 AI "大脑"中产生的各种交流,而日志是代码行为。

**活动生命周期**:
- 活动处理后由TypeScript垃圾回收机制自动回收
- 不刻意保留活动对象，仅在日志中记录用于调试

### 活动存储

活动存储在两个位置:

1. **活动流**:所有产生的活动,包括注意域中的活动
2. **注意域**:部分活动,不包括 UnderConscious 活动,且经 Hub 筛选

## Hub 协调器详解

Hub 是 Faculty 的协调者,负责活动路由和 Faculty 管理。

### 管理其他 Faculty

- 其他 Faculty 需要注册在 Hub 中
- Faculty 可以注册特定条件的活动处理
- 当遇到特定活动时,Hub 调用相应功能
- 其他 Faculty 向 Hub append 活动,Hub 则直接调用这些 Faculty 的功能(不是发送活动)

**活动响应机制**:

当活动流出现被注册的活动时,Hub 需要响应并调用相应功能。

**调用机制设计说明**:
- **Faculty→Hub**: 使用活动机制，符合事件流式组织理念
- **Hub→Faculty**: 使用直接调用，Hub作为协调器需要直接控制 Faculty 行为
- **调用特性**: 异步调用，无返回值，Faculty 通过产生新活动来"返回"结果
- **错误处理**: Hub捕获 Faculty 调用异常，防止单个 Faculty 错误影响整个系统（错误记录到日志，不进入活动流）


