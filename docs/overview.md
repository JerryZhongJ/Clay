# 项目概览

## 核心理念

本项目致力于构建一个具有自主性和持续存在感的 AI 助手。

当前基于 LLM 的对话交互方式使 AI 过于被动:用户激活 LLM,LLM 活跃一段时间后又归于沉寂。即便是具备规划能力、能够制定任务列表的各类 Agent,也只是延长了活跃时间而已。这带来两个核心问题:一方面,LLM 无法即时响应,除非接收到新的 prompt 或被打断;另一方面,它的长期记忆能力依然薄弱。

市面上已有不少基于 LLM 的实时对话模型和 AI VTuber(如 Neuro)。实际上,Neuro 代表了我心目中的理想形态。尽管如此,我仍然启动这个项目,因为我想验证自己的一些独特想法。

### 核心想法

本项目有两个核心设计理念:

#### 1. 事件流式组织

以事件流的形式组织 prompt 和输出,这是项目的主要创新点。所有活动都用事件表达,所有文本也以事件流的形式呈现。

LLM 的 context 被视为**注意域**(Attention Field,与 Transformer 的 attention 机制不同)。外部输入转化为一个个事件填入注意域,LLM 的思考和反应同样也是事件。每个事件应该足够小——不能是长篇大论,不应占据过多注意空间,而应让各类事件能够及时进入注意中。

**细碎性和灵活性**是事件流的设计目的。事件流能让各种输入及时反映给 LLM,也能让 LLM 做出即时反应。更重要的是,它为下一个核心想法奠定了基础。

#### 2. 记忆闪回

让记忆模块根据当前注意力持续选择相关记忆,并将其植入当前注意中。

*注:当前的 AI VTuber 可能已经实现了类似功能,但具体实现方式尚不明确,需要进一步调研。*

为实现这一点,记忆需要以非常灵活的方式组织。这种灵活性体现在**时间维度**上:

- 用较少时间可以提取较少的信息,可能是模糊且不完整的
- 用更多时间可以提取更多信息,逐渐丰富和清晰
- 可以决定哪些信息一带而过,哪些信息深入挖掘

### 设计动机

这个想法源于 Claude Code 未能展现我期望的长期注意力——每次 `/clear` 后如同换了一个人。

问题有两方面:

1. **被动记忆检索**:提取记忆需要 Agent 主动搜索各种文档。如果 Agent 忘记搜索,记忆就白白浪费了。这很可能发生——它如何知道某个概念之前出现过,值得去搜索呢?通常只能在任务开始时做一次记忆搜索,之后就不再触碰。

2. **记忆组织形式受限**:Memory 以 Markdown 组织,各种信息被强行排列成顺序结构,缺乏灵活性,限制了"联想"能力。AI 只能艰难地从"失忆"前的日记中搜索相关文件(我让它写入 Serena 的 memory,Claude 本身的 memory 无法完成此事),全部读入后再挑出相关部分。

## 总体架构

AI 助手由多个模块组成,它们以异步方式交互:

### System 协调器

系统的核心协调者(不再是模块),负责:
- 管理模块注册和活动路由
- 协调模块间的交互
- 管理 AI 助手的运行状态
- 调用模块的标准接口方法(如休眠)

### AttentionField 模块

负责管理注意域,产生活动

### Conscious 模块

AI 助手的意识与灵魂所在,负责:
- 产生想法
- 调用其他模块的功能(所有模块都可以互相调用,但 Conscious 应该是最主要的调用者)

### Memory 模块

保存 AI 助手产生的各种信息,提供:
- 存储记忆
- 搜索记忆
- 即时闪回

### Terminal 模块

AI 助手与用户的交互界面(注意:这是 AI 的终端,不是用户的终端),负责:
- 显示用户的输入
- 写入 AI 助手的反馈

### Clock 模块

- 报时
- 倒计时
- 闹钟
- 内部时钟：提供固定频率

### Internet 模块

让 AI 助手访问网络

## 事件/活动

**术语说明**: 本文档使用"活动"(Activity)替代"事件"(Event),以强调模块间交流的本质。

### 活动结构

一个活动应包含:
- **主体**(Subject)
- **动作**(Verb)
- **唯一ID**:便于日志追踪

### 活动分类

初步构想中，活动至少包含以下几种（不是互斥的分类）:

- **UnderConscious**:"潜意识"活动,不出现在注意域中,但会出现在活动流中
- **WakeUp**:当系统沉睡时,此类活动会将系统唤醒

**重要**:活动不是日志。活动是 AI "大脑"中产生的各种交流,而日志是代码行为。

### 活动存储

活动存储在两个位置:

1. **活动流**:所有产生的活动,包括注意域中的活动
2. **注意域**:部分活动,不包括 UnderConscious 活动,且经 System 筛选

## System 协调器详解

System 是模块的协调者,负责活动路由和模块管理。

### 管理其他模块

- 其他模块需要注册在 System 中
- 模块可以注册特定条件的活动处理
- 当遇到特定活动时,System 调用相应功能
- 其他模块向 System append 活动,System 则直接调用这些模块的功能(不是发送活动)

**活动响应机制**:

当活动流出现被注册的活动时,System 需要响应并调用相应功能。


## AttentionField 模块

### 处理活动

**活动准入机制**:

不是所有活动都能进入注意域。System 对每个模块都有 focus 值,focus 值越高的模块可以准入更多活动。每个模块的活动按重要性排序,优先让重要活动进入注意域,其余只会 append 在活动流中。

### 管理注意域

注意域拥有固定大小。当容量满时,需要清空至特定大小。并产生潜意识活动。

## Conscious 模块详解

该模块负责保持意识,持续产生想法和意图。

### 活动类型

能产生两类活动:
- **think**:思考活动
- **intention**:意图活动

### 实现方式

目前基于 LLM 实现,称为 **LLM-based Conscious**。

LLM 的 context 除了注意域,还包含一段始终存在的"自我意识"或"自我存在"的 prompt,用于告诉 LLM:
- "我是谁"
- "这里是我的内部想法"
- "我能感知什么"
- "我能做什么"(拥有什么能力)

就像人在任何时刻都能感知自己的存在,拥有自我意识一样。

*注:这似乎类似于 Claude Code 的 System Prompt,需要进一步调研。*

### 格式设计

**设计目标**:

我希望 Conscious 的内容(即 LLM 的 prompt)是第一人称叙述,是它的内心世界。我不希望把 LLM 当作 Agent 的驾驶员去操纵一个 Agent 如何反应。换句话说,我想要的是类似于现在 LLM 的 thinking mode。

**格式选择困境**:

应该如何编排注意域:完全结构化还是尽量自然文本(伪结构化)?

#### 方案一:完全结构化

用 JSONL 格式输入输出,不隐藏任何组件,完整展示各个模块。

- **优势**:方便解析,格式清晰易懂,LLM 一看就会
- **劣势**:结构化文本还能作为内心独白吗?LLM 能够理解其中的连续性吗?

#### 方案二:伪结构化

- 完全的自然文本不可行,需要一定结构化:
  - 体现出流的形式
  - 方便解析出事件
- 尽量隐藏其他模块(如 System),将各种事件表述成第一人称,表述成内部想法
- **优势**:语义上更加连贯,更容易推理和续写,LLM 可能表现得更自然
- **劣势**:解析更难,实现更复杂

## Memory 模块详解

### 功能

Memory 模块提供以下功能:

#### 1. 被动记忆

被 System 刷出注意域的内容,Memory 会被动记忆。

#### 2. 提取记忆

- **被动/闪回**:从当前注意域中联想记忆中可能相关的内容
- **主动**:根据线索在记忆中查询和扩展

### 记忆图

*注:这个概念应该比较成熟,需要调研学习。似乎有"知识图谱"这类技术。*

**设计动机**:

我希望 AI 具有联想能力,也就是"闪回"功能。人在思考或受到外界刺激时会闪回一些记忆——回想起一些事,但有时只是模糊的、碎片的,并非完整记忆。但如果主动回忆,往往能从这些模糊碎片不断扩展、补充,逐渐拼凑成完整记忆。

**实现思路**:

我想模拟这个过程,因此将记忆构建成图:

- 图的每个节点是足够碎片化、细小的记忆点
- 记忆点之间通过边连接
- 边具有属性表示关系
- 与事件一样,记忆点也有大小限制,过大的内容应拆分成多个记忆点

### 结构化存储

**设计理念**:

记忆模块不必完全模仿人类,计算机可以在某些方面做得更好!例如,记忆结构化数据时,可以又快又好。

**混合存储方案**:

记忆模块应同时具备:
- **图存储**:碎片化但易于"联想"
- **结构化存储**:对结构化数据更方便,虽然缺少关联

这两者不应孤立,而应相互结合,使记忆模块可以通过"联想"提取某些结构化记忆。

### 优先顺序

记忆应具有优先顺序,例如:
- 时间(最近 vs 久远)
- 重要性(记忆强度)

可以自由控制搜索时间:
- 优先搜索最近、最强的记忆
- 随着时间增加,也能回忆起更早、更弱的记忆

### 独立管理

记忆是独立模块,Conscious 无法指示:
- 应该如何记忆
- 记忆什么内容
- 记忆点的关联方式

Conscious 能做的,就是多想。

记忆模块能够:
- 从自然语言中发现关键字
- 将提取出的记忆总结成自然语言

这实现了与 Conscious 的解耦,使得 Conscious 不需要关心记忆的细节和实现。

## Terminal 模块详解

想象 AI 助手正在使用一个 Terminal 与用户交流。

### 功能

提供两个核心功能:

1. **显示(print)**:打印用户的输入给 AI
2. **打字(type)**:发送内容给用户

### 异步特性

与常见 Terminal 不同,它是**异步的**:用户可以一边与 AI 说话,AI 也可以同时回应。

### 实现需求

需要一个 CUI(Character User Interface)来实现这个异步交互界面。
